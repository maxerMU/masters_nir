\chapter{Конструкторский раздел}

\section{Особенности входных данных}
На вход метода поступает изображение, на которое накладываются следующие ограничения:
\begin{itemize}
	\item изображение в формате PNG или JPEG;
	\item размер изображения 800 на 800 пикселей;
	\item размер самолетов на изображении больше 70 пикселей;
	\item изображение сделано под углом 90 градусов к поверхности Земли.
\end{itemize}

Результатом работы метода являются распознанные самолеты, а именно их количество, расположение на входном изображении и их модели.

Программное обеспечение должно предоставлять интерфейс для разработанного метода со следующими функциями:
\begin{itemize}
	\item возможность выбора и использования одной из заранее обученных моделей;
	\item возможность загрузки аэрофотоснимка с летательной техникой и получение информации о распознанных на нем летательных объектах, а именно их количество, местоположение и модели;
	\item возможность загрузки изображения c одним самолетом и получение результатов о классе летательной техники на нем.
\end{itemize}


\section{Проектирование метода}
IDEF-0 диаграмма метода распознавания летательной техники с аэрофотоснимков уровня A1 приведена на рисунке \ref{img:idef0A1}.
\includeimage
{idef0A1} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{\textwidth} % Ширина рисунка
{IDEF-0 диаграмма уровня A1} % Подпись рисунка

Решение задачи распознавания самолетов на аэрофотоснимках было поделено на две подзадачи: детектирование объектов на изображении и их классификация.

В качестве модели классификации была выбрана сверточная нейронная сеть из 12 сверточных слоев, выходы которой соединены с двухслойным перцептроном.

Обучаемая модель имеет следующую структуру:
\begin{itemize}
	\item слой свертки с 64 фильтрами, размером ядра 3 на 3 пикселя, шагом и отступом по одному пикселю;
	\item три аналогичных слоя с 128 фильтрами;
	\item слой max pooling, c размером ядра 2 на 2 пикселя и шагом 2, размер выходных матриц после этого слоя становится 48 на 48;
	\item два слоя с 128 фильтрами, размером ядра 3 на 3 пикселя, шагом и отступом по одному пикселю;
	\item аналогичный слой с 256 фильтрами;
	\item слой max pooling, c размером ядра 2 на 2 пикселя и шагом 2, размер выходных матриц после этого слоя становится 24 на 24;
	\item слой свертки с 256 фильтрами, размером ядра 3 на 3 пикселя, шагом и отступом по одному пикселю;
	\item слой max pooling, c размером ядра 2 на 2 пикселя и шагом 2, размер выходных матриц после этого слоя становится 12 на 12;
	\item слой свертки с 512 фильтрами, размером ядра 3 на 3 пикселя, шагом и отступом по одному пикселю;
	\item слой max pooling, c размером ядра 2 на 2 пикселя и шагом 2, размер выходных матриц после этого слоя становится 6 на 6;
	\item слой свертки с 2048 фильтрами, размером ядра 3 на 3 пикселя, шагом и отступом по одному пикселю;
	\item слой свертки с 256 фильтрами, размером ядра 3 на 3 пикселя, шагом и отступом по одному пикселю;
	\item слой max pooling, c размером ядра 2 на 2 пикселя и шагом 2, размер выходных матриц после этого слоя становится 3 на 3;
	\item слой свертки с 256 фильтрами, размером ядра 3 на 3 пикселя, шагом один пиксель;
	\item входной слой перцептрона, состоящий из 256 нейронов;
	\item выходной слой перцептрона, состоящий из 20 нейронов.
\end{itemize}

После каждого сверточного слоя применяется слой нормализации, описанный в главе \ref{sec:normalisation} и функция активации ReLU. Такая архитектура нейронной сети имеет следующие преимущества:
\begin{itemize}
	\item использование сверточных слоев позволяет выделять различные признаки, такие как границы, формы, вне зависимости от их расположения в входном изображении;
	\item использование пуллинговых слоев позволяет уменьшить размерность изображения с сохранением отличительных признаков;
	\item несмотря на количество слоев, такая архитектура за счет использования пуллинговых слоев и сверток с ядром 3 на 3 вместо 5 на 5 и больших имеет относительно немного обучаемых параметров: 4910356 в сравнении с шестьюдесятью миллионами в архитектуре AlexNet, которая была описана в главе \ref{sec:alexnet}.
\end{itemize}

Использование меньшего числа параметров приводит к уменьшению скорости обучения нейронной сети, а также к меньшим ограничениям на вычислительные ресурсы при использовании модели, что важно, так как все изображения, которые поступают на вход модели, сделаны с беспилотных летательных аппаратов и могут на них же обрабатываться.

Для решения задачи детектирования объектов была выбрана нейронная сеть Yolo v3, состоящая из 106 сверточных слоев, среди которых сверточный слои с размером ядра 3 на 3 и 1 на 1 и шагом свертки 1 или 2 пикселя, а также блоки, в которых используется техника пропуска соединений.

Всего такая сеть выдает три матрицы предсказаний для размеров ячеек 25, 50 и 100 пикселей.

Схемы алгоритмов обучения нейронных сетей и прохождения одной эпохи приведены на рисунках \ref{img:training} и \ref{img:training_epoch} соответственно.
\includeimage
{training} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{0.6\textwidth} % Ширина рисунка
{Схема алгоритма обучения нейронной сети} % Подпись рисунка

\includeimage
{training_epoch} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{0.4\textwidth} % Ширина рисунка
{Схема алгоритма прохождения одной эпохи} % Подпись рисунка

При подсчете точности модели на тестовой выборке важно учитывать ее размер и загружать в оперативную память по частям, каждый раз освобождая выделенные ресурсы.

\section{Структура программного обеспечения}

Программное обеспечение состоит из четырех модулей:
\begin{itemize}
	\item модуль, реализующий модель нейронной сети детектирования летальной техники;
	\item модуль, реализующий модель нейронной сети классификации летальной техники;
	\item модуль, реализующий интерфейс взаимодействия с пользователем;
	\item модуль пользовательского интерфейса.
\end{itemize}

Структурная схема взаимодействия модулей разрабатываемого программного обеспечения представлена на рисунке \ref{img:modules}.

Модули детектирования и классификации используются для обучения моделей и взаимодействия с уже обученными. После завершения обучения параметры модели должны быть сохранены в файл для обеспечения в дальнейшем загрузки модели без обучения.

Модуль взаимодействия с пользователем должен обеспечивать следующие возможности:
\begin{itemize}
	\item загрузка одной из заранее обученных моделей;
	\item загрузка изображения с летательной техникой и определение ее класса с помощью загруженной или обученной модели;
	\item загрузка аэрофотоснимка с различными классами летательной техники и определение их классов.
\end{itemize} 

\section{Набор обучающих данных}

Для обучения нейронной сети был выбран набор данных из источника \cite{planesdataset}, состоящий из 3842 снимков аэропортов, сделанных с беспилотных летательных аппаратов. На этих снимках находится 22341 самолет 20 различных типов.

Пример элемента обучающей выборки приведен на рисунке \ref{img:trainexample}.


Вся выборка была поделена на обучающую и тестовую. Обучающая выборка содержит 20344 самолета, а тестовая -- 1997.

\section{Вывод}

В данном разделе были определены ограничения, которые накладываются на входное изображение, и требования, которые предъявляются к разрабатываемому программному обеспечению.

Была детализирована IDEF-0 диаграмма уровня А0, описанная в разделе формализованной постановки задачи, а также было проведено разбиение программного обеспечения на модули и описание функциональных требований, которые они должны обеспечивать. Задача распознавания самолетов была разбита на две подзадачи: детектирование объектов на изображении и их классификация.

Были определены архитектуры нейронных сетей классификации и детектирования, а также преимущества использования именно таких архитектур. Была определена схема алгоритма обучения составленных нейронных сетей.

Была найдена выборка данных, которые будут использоваться для обучения моделей, и было произведено ее деление на две части: обучающую и тестовую.